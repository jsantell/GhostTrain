!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.GhostTrain=e()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){module.exports=require("./lib/ghosttrain")},{"./lib/ghosttrain":3}],2:[function(require,module,exports){exports.get=function get(obj,prop,func){if(Object.defineProperty){try{Object.defineProperty(obj,prop,{get:func})}catch(e){}}};exports.isSupported=function isSupported(){var obj={};exports.get(obj,"supported",function(){return true});return obj.supported}},{}],3:[function(require,module,exports){var utils=require("./utils");var sendRequest=require("./sendRequest");var methods=require("./methods");var each=require("foreach-shim");function GhostTrain(){this.routes={};this.settings={"case sensitive routing":false,"strict routing":false,"json replacer":undefined,"json spaces":undefined}}module.exports=GhostTrain;each(methods,function(verb){if(verb==="get"){GhostTrain.prototype.get=function(){if(arguments.length===1)return this.settings[arguments[0]];else return utils.addRoute("get").apply(this,utils.arrayify(arguments))}}else{GhostTrain.prototype[verb]=utils.addRoute(verb)}});GhostTrain.prototype.set=function(key,value){this.settings[key]=value};GhostTrain.prototype.enable=function(key){this.settings[key]=true};GhostTrain.prototype.enable=function(key){this.settings[key]=false};GhostTrain.prototype.request=function(){return sendRequest.apply(null,[this].concat(utils.arrayify(arguments)))}},{"./methods":4,"./sendRequest":8,"./utils":10,"foreach-shim":12}],4:[function(require,module,exports){module.exports=["get","post","put","head","delete","options","trace","copy","lock","mkcol","move","propfind","proppatch","unlock","report","mkactivity","checkout","merge","m-search","notify","subscribe","unsubscribe","patch","search"]},{}],5:[function(require,module,exports){var mime=require("simple-mime")();var parseRange=require("range-parser");var parseURL=require("./url").parse;var unsupported=require("./utils").unsupported;var get=require("./get").get;var each=require("foreach-shim");function Request(ghosttrain,route,url,options){this.headers=options.headers||{};var protocol="window"in this?window.location.protocol:"";var parsedURL=parseURL(url,true);this.path=parsedURL.pathname;this.query=parsedURL.query;this.protocol=(parsedURL.protocol||protocol).replace(":","");this.secure=this.protocol==="https";this.route=route;this.method=route.method.toUpperCase();this.url=this.originalUrl=url;this.params=route.params;this.body=options.body||{};this.headers=options.headers||{};this.xhr="xmlhttprequest"===(this.get("X-Requested-With")||"").toLowerCase()}module.exports=Request;Request.prototype.range=function(size){var range=this.get("Range");if(!range)return;return parseRange(size,range)};Request.prototype.is=function(type){var ct=this.get("Content-Type");if(!type)return false;if(!ct)return false;ct=ct.split(";")[0];if(!~type.indexOf("/"))type=mime(type);if(~type.indexOf("*")){type=type.split("/");ct=ct.split("/");if("*"==type[0]&&type[1]==ct[1])return true;if("*"==type[1]&&type[0]==ct[0])return true;return false}return!!~ct.indexOf(type)};Request.prototype.get=Request.prototype.header=function(name){return this.headers[name]};Request.prototype.param=function(name,defaultValue){var params=this.params||{};var body=this.body||{};var query=this.query||{};if(null!=params[name]&&params.hasOwnProperty(name))return params[name];if(null!=body[name])return body[name];if(null!=query[name])return query[name];return defaultValue};each(["accepts","acceptsEncoding","acceptsCharset","acceptsLanguage"],function(prop){Request.prototype[prop]=unsupported("req."+prop+"()")});each(["subdomains","stale","fresh","ip","ips","auth","accepted","acceptedEncodings","acceptedCharsets","acceptedLanguages"],function(prop){get(Request.prototype,prop,unsupported("req."+prop))})},{"./get":2,"./url":9,"./utils":10,"foreach-shim":12,"range-parser":16,"simple-mime":17}],6:[function(require,module,exports){var mime=require("simple-mime")();var utils=require("./utils");var unsupported=utils.unsupported;var each=require("foreach-shim");var map=require("array-map");function Response(ghosttrain,callback){this.charset="";this.headers={};this.statusCode=200;this.app=ghosttrain;this._callback=callback}module.exports=Response;Response.prototype={send:function(){var body;var app=this.app;if(typeof arguments[0]==="number"){this.status(arguments[0]);body=arguments[1]}else{body=arguments[0]}var type=this.get("Content-Type");if(!body&&type!=="application/json"){body=utils.STATUS_CODES[this.statusCode];if(!type)this.type("txt")}else if(typeof body==="string"){if(!type){this.charset=this.charset||"utf-8";this.type("html")}}else if(typeof body==="object"){if(body===null)body="";else if(!type||type==="application/json"){this.contentType("application/json");var replacer=app.get("json replacer");var spaces=app.get("json spaces");body=JSON.stringify(body,replacer,spaces)}}this.end(body);return this},json:function(){var data;if(arguments.length===2){this.status(arguments[0]);data=arguments[1]}else{data=arguments[0]}if(!this.get("Content-Type"))this.contentType("application/json");return this.send(data)},status:function(code){this.statusCode=code;return this},set:function(field,value){if(arguments.length===2)this.headers[field]=value;else{for(var prop in field)this.headers[prop]=field[prop]}return this},header:function(field,value){return this.set(field,value)},get:function(field){return this.headers[field]},links:function(links){var link=this.get("Link")||"";if(link)link+=", ";return this.set("Link",link+map(Object.keys(links),function(rel){return"<"+links[rel]+'>; rel="'+rel+'"'}).join(", "))},contentType:function(type){return this.set("Content-Type",~type.indexOf("/")?type:mime(type))},type:function(type){return this.contentType(type)},end:function(body){var type=this.get("Content-Type");if(type==="application/json")this._callback(JSON.parse(body||"{}"));else this._callback(body)}};each(["clearCookie","cookie","attachment","jsonp","sendfile","download","format","location","redirect","vary","render"],function(prop){Response.prototype[prop]=unsupported("res."+prop+"()")})},{"./utils":10,"array-map":11,"foreach-shim":12,"simple-mime":17}],7:[function(require,module,exports){var utils=require("./utils");function Route(method,path,callback,options){this.path=path;this.method=method;this.callback=callback;this.regexp=utils.pathRegexp(path,this.keys=[],options.sensitive,options.strict)}module.exports=Route;Route.prototype.match=function(path){var keys=this.keys;var params=this.params=[];var m=this.regexp.exec(path);if(!m)return false;for(var i=1,len=m.length;i<len;++i){var key=keys[i-1];try{var val="string"==typeof m[i]?decodeURIComponent(m[i]):m[i]}catch(e){var err=new Error("Failed to decode param '"+m[i]+"'");err.status=400;throw err}if(key)params[key.name]=val;else params.push(val)}return true}},{"./utils":10}],8:[function(require,module,exports){var Request=require("./request");var Response=require("./response");var parseURL=require("./url").parse;var each=require("foreach-shim");function send(ghosttrain,verb,url,params,callback){var req,res;verb=verb.toLowerCase();if(typeof arguments[3]==="function"){callback=params;params={}}if(!params)params={};var options={};for(var prop in params)options[prop]=params[prop];if(!options.headers)options.headers={};if(options.contentType)options.headers["Content-Type"]=options.contentType;var route=findRoute(ghosttrain,verb,url);function execute(){if(route){req=new Request(ghosttrain,route,url,options);res=new Response(ghosttrain,success);route.callback(req,res)}else{if(callback)callback("404: No route found.",null,null)}}setTimeout(execute,options.delay||1);function success(data){if(!callback)return;callback(null,render(req,res,data),data)}}module.exports=send;function findRoute(ghosttrain,verb,path){var routes=ghosttrain.routes[verb];if(!routes)return null;for(var i=0;i<routes.length;i++)if(routes[i].match(path))return routes[i];return null}function render(req,res,body){var response={};var parsedURL=parseURL(req.url);for(var prop in parsedURL)response[prop]=parsedURL[prop];each(["method","url"],function(prop){response[prop]=req[prop]});each(["headers","statusCode"],function(prop){response[prop]=res[prop]});response.body=body;return response}},{"./request":5,"./response":6,"./url":9,"foreach-shim":12}],9:[function(require,module,exports){exports.parse=urlParse;var protocolPattern=/^([a-z0-9]+:)/,portPattern=/:[0-9]+$/,nonHostChars=["/","?",";","#"],hostlessProtocol={file:true,"file:":true},slashedProtocol={http:true,https:true,ftp:true,gopher:true,file:true,"http:":true,"https:":true,"ftp:":true,"gopher:":true,"file:":true},querystring=require("querystring");function urlParse(url,parseQueryString,slashesDenoteHost){if(url&&typeof url==="object"&&url.href)return url;var out={href:url},rest=url;var proto=protocolPattern.exec(rest);if(proto){proto=proto[0];out.protocol=proto;rest=rest.substr(proto.length)}if(slashesDenoteHost||proto||rest.match(/^\/\/[^@\/]+@[^@\/]+/)){var slashes=rest.substr(0,2)==="//";if(slashes&&!(proto&&hostlessProtocol[proto])){rest=rest.substr(2);out.slashes=true}}if(!hostlessProtocol[proto]&&(slashes||proto&&!slashedProtocol[proto])){var firstNonHost=-1;for(var i=0,l=nonHostChars.length;i<l;i++){var index=rest.indexOf(nonHostChars[i]);if(index!==-1&&(firstNonHost<0||index<firstNonHost))firstNonHost=index}if(firstNonHost!==-1){out.host=rest.substr(0,firstNonHost);rest=rest.substr(firstNonHost)}else{out.host=rest;rest=""}var p=parseHost(out.host);var keys=Object.keys(p);for(var i=0,l=keys.length;i<l;i++){var key=keys[i];out[key]=p[key]}out.hostname=out.hostname||""}var hash=rest.indexOf("#");if(hash!==-1){out.hash=rest.substr(hash);rest=rest.slice(0,hash)}var qm=rest.indexOf("?");if(qm!==-1){out.search=rest.substr(qm);out.query=rest.substr(qm+1);if(parseQueryString){out.query=querystring.parse(out.query)}rest=rest.slice(0,qm)}else if(parseQueryString){out.query={}}if(rest)out.pathname=rest;return out}function parseHost(host){var out={};var at=host.indexOf("@");if(at!==-1){out.auth=host.substr(0,at);host=host.substr(at+1)}var port=portPattern.exec(host);if(port){port=port[0];out.port=port.substr(1);host=host.substr(0,host.length-port.length)}if(host)out.hostname=host;return out}},{querystring:15}],10:[function(require,module,exports){var Route=require("./route");function addRoute(verb){return function(path,fn){if(!this.routes[verb])this.routes[verb]=[];this.routes[verb].push(new Route(verb,path,fn,{sensitive:this.settings["case sensitive routing"],strict:this.settings["strict routing"]}))}}exports.addRoute=addRoute;function unsupported(name){return function(){throw new Error("`"+name+"` is currently unsupported")}}exports.unsupported=unsupported;function arrayify(args){return Array.prototype.slice.call(args,0)}exports.arrayify=arrayify;function pathRegexp(path,keys,sensitive,strict){if(Object.prototype.toString.call(path)=="[object RegExp]")return path;if(Array.isArray(path))path="("+path.join("|")+")";path=path.concat(strict?"":"/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?(\*)?/g,function(_,slash,format,key,capture,optional,star){keys.push({name:key,optional:!!optional});slash=slash||"";return""+(optional?"":slash)+"(?:"+(optional?slash:"")+(format||"")+(capture||(format&&"([^/.]+?)"||"([^/]+?)"))+")"+(optional||"")+(star?"(/*)?":"")}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.*)");return new RegExp("^"+path+"$",sensitive?"":"i")}exports.pathRegexp=pathRegexp;var STATUS_CODES=exports.STATUS_CODES={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Time-out",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Large",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Time-out",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"}},{"./route":7}],11:[function(require,module,exports){module.exports=function(xs,f){if(xs.map)return xs.map(f);var res=[];for(var i=0;i<xs.length;i++){var x=xs[i];if(hasOwn.call(xs,i))res.push(f(x,i,xs))}return res};var hasOwn=Object.prototype.hasOwnProperty},{}],12:[function(require,module,exports){"use strict";module.exports=function(arr,callback,context){for(var i=0,l=arr.length;i<l;i++){callback.call(context,arr[i],i,arr)}}},{}],13:[function(require,module,exports){"use strict";function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}module.exports=function(qs,sep,eq,options){sep=sep||"&";eq=eq||"=";var obj={};if(typeof qs!=="string"||qs.length===0){return obj}var regexp=/\+/g;qs=qs.split(sep);var maxKeys=1e3;if(options&&typeof options.maxKeys==="number"){maxKeys=options.maxKeys}var len=qs.length;if(maxKeys>0&&len>maxKeys){len=maxKeys}for(var i=0;i<len;++i){var x=qs[i].replace(regexp,"%20"),idx=x.indexOf(eq),kstr,vstr,k,v;if(idx>=0){kstr=x.substr(0,idx);vstr=x.substr(idx+1)}else{kstr=x;vstr=""}k=decodeURIComponent(kstr);v=decodeURIComponent(vstr);if(!hasOwnProperty(obj,k)){obj[k]=v}else if(isArray(obj[k])){obj[k].push(v)}else{obj[k]=[obj[k],v]}}return obj};var isArray=Array.isArray||function(xs){return Object.prototype.toString.call(xs)==="[object Array]"}},{}],14:[function(require,module,exports){"use strict";var stringifyPrimitive=function(v){switch(typeof v){case"string":return v;case"boolean":return v?"true":"false";case"number":return isFinite(v)?v:"";default:return""}};module.exports=function(obj,sep,eq,name){sep=sep||"&";eq=eq||"=";if(obj===null){obj=undefined}if(typeof obj==="object"){return map(objectKeys(obj),function(k){var ks=encodeURIComponent(stringifyPrimitive(k))+eq;if(isArray(obj[k])){return obj[k].map(function(v){return ks+encodeURIComponent(stringifyPrimitive(v))}).join(sep)}else{return ks+encodeURIComponent(stringifyPrimitive(obj[k]))}}).join(sep)}if(!name)return"";return encodeURIComponent(stringifyPrimitive(name))+eq+encodeURIComponent(stringifyPrimitive(obj))};var isArray=Array.isArray||function(xs){return Object.prototype.toString.call(xs)==="[object Array]"};function map(xs,f){if(xs.map)return xs.map(f);var res=[];for(var i=0;i<xs.length;i++){res.push(f(xs[i],i))}return res}var objectKeys=Object.keys||function(obj){var res=[];for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))res.push(key)}return res}},{}],15:[function(require,module,exports){"use strict";exports.decode=exports.parse=require("./decode");exports.encode=exports.stringify=require("./encode")},{"./decode":13,"./encode":14}],16:[function(require,module,exports){module.exports=function(size,str){var valid=true;var i=str.indexOf("=");if(-1==i)return-2;var arr=str.slice(i+1).split(",").map(function(range){var range=range.split("-"),start=parseInt(range[0],10),end=parseInt(range[1],10);if(isNaN(start)){start=size-end;end=size-1}else if(isNaN(end)){end=size-1}if(end>size-1)end=size-1;if(isNaN(start)||isNaN(end)||start>end||start<0)valid=false;return{start:start,end:end}});arr.type=str.slice(0,i);return valid?arr:-1}},{}],17:[function(require,module,exports){var types;module.exports=function setup(defaultMime){return function getMime(path){path=path.toLowerCase().trim();var index=path.lastIndexOf("/");if(index>=0){path=path.substr(index+1)}index=path.lastIndexOf(".");if(index>=0){path=path.substr(index+1)}return types[path]||defaultMime}};types={"3gp":"video/3gpp",a:"application/octet-stream",ai:"application/postscript",aif:"audio/x-aiff",aiff:"audio/x-aiff",asc:"application/pgp-signature",asf:"video/x-ms-asf",asm:"text/x-asm",asx:"video/x-ms-asf",atom:"application/atom+xml",au:"audio/basic",avi:"video/x-msvideo",bat:"application/x-msdownload",bin:"application/octet-stream",bmp:"image/bmp",bz2:"application/x-bzip2",c:"text/x-csrc",cab:"application/vnd.ms-cab-compressed",can:"application/candor",cc:"text/x-c++src",chm:"application/vnd.ms-htmlhelp","class":"application/octet-stream",com:"application/x-msdownload",conf:"text/plain",cpp:"text/x-c",crt:"application/x-x509-ca-cert",css:"text/css",csv:"text/csv",cxx:"text/x-c",deb:"application/x-debian-package",der:"application/x-x509-ca-cert",diff:"text/x-diff",djv:"image/vnd.djvu",djvu:"image/vnd.djvu",dll:"application/x-msdownload",dmg:"application/octet-stream",doc:"application/msword",dot:"application/msword",dtd:"application/xml-dtd",dvi:"application/x-dvi",ear:"application/java-archive",eml:"message/rfc822",eps:"application/postscript",exe:"application/x-msdownload",f:"text/x-fortran",f77:"text/x-fortran",f90:"text/x-fortran",flv:"video/x-flv","for":"text/x-fortran",gem:"application/octet-stream",gemspec:"text/x-script.ruby",gif:"image/gif",gyp:"text/x-script.python",gypi:"text/x-script.python",gz:"application/x-gzip",h:"text/x-chdr",hh:"text/x-c++hdr",htm:"text/html",html:"text/html",ico:"image/vnd.microsoft.icon",ics:"text/calendar",ifb:"text/calendar",iso:"application/octet-stream",jar:"application/java-archive",java:"text/x-java-source",jnlp:"application/x-java-jnlp-file",jpeg:"image/jpeg",jpg:"image/jpeg",js:"application/javascript",json:"application/json",less:"text/css",log:"text/plain",lua:"text/x-script.lua",luac:"application/x-bytecode.lua",makefile:"text/x-makefile",m3u:"audio/x-mpegurl",m4v:"video/mp4",man:"text/troff",manifest:"text/cache-manifest",markdown:"text/x-markdown",mathml:"application/mathml+xml",mbox:"application/mbox",mdoc:"text/troff",md:"text/x-markdown",me:"text/troff",mid:"audio/midi",midi:"audio/midi",mime:"message/rfc822",mml:"application/mathml+xml",mng:"video/x-mng",mov:"video/quicktime",mp3:"audio/mpeg",mp4:"video/mp4",mp4v:"video/mp4",mpeg:"video/mpeg",mpg:"video/mpeg",ms:"text/troff",msi:"application/x-msdownload",odp:"application/vnd.oasis.opendocument.presentation",ods:"application/vnd.oasis.opendocument.spreadsheet",odt:"application/vnd.oasis.opendocument.text",ogg:"application/ogg",p:"text/x-pascal",pas:"text/x-pascal",pbm:"image/x-portable-bitmap",pdf:"application/pdf",pem:"application/x-x509-ca-cert",pgm:"image/x-portable-graymap",pgp:"application/pgp-encrypted",pkg:"application/octet-stream",pl:"text/x-script.perl",pm:"text/x-script.perl-module",png:"image/png",pnm:"image/x-portable-anymap",ppm:"image/x-portable-pixmap",pps:"application/vnd.ms-powerpoint",ppt:"application/vnd.ms-powerpoint",ps:"application/postscript",psd:"image/vnd.adobe.photoshop",py:"text/x-script.python",qt:"video/quicktime",ra:"audio/x-pn-realaudio",rake:"text/x-script.ruby",ram:"audio/x-pn-realaudio",rar:"application/x-rar-compressed",rb:"text/x-script.ruby",rdf:"application/rdf+xml",roff:"text/troff",rpm:"application/x-redhat-package-manager",rss:"application/rss+xml",rtf:"application/rtf",ru:"text/x-script.ruby",s:"text/x-asm",sgm:"text/sgml",sgml:"text/sgml",sh:"application/x-sh",sig:"application/pgp-signature",snd:"audio/basic",so:"application/octet-stream",svg:"image/svg+xml",svgz:"image/svg+xml",swf:"application/x-shockwave-flash",t:"text/troff",tar:"application/x-tar",tbz:"application/x-bzip-compressed-tar",tci:"application/x-topcloud",tcl:"application/x-tcl",tex:"application/x-tex",texi:"application/x-texinfo",texinfo:"application/x-texinfo",text:"text/plain",tif:"image/tiff",tiff:"image/tiff",torrent:"application/x-bittorrent",tr:"text/troff",ttf:"application/x-font-ttf",txt:"text/plain",vcf:"text/x-vcard",vcs:"text/x-vcalendar",vrml:"model/vrml",war:"application/java-archive",wav:"audio/x-wav",webapp:"application/x-web-app-manifest+json",webm:"video/webm",wma:"audio/x-ms-wma",wmv:"video/x-ms-wmv",wmx:"video/x-ms-wmx",wrl:"model/vrml",wsdl:"application/wsdl+xml",xbm:"image/x-xbitmap",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xml:"application/xml",xpm:"image/x-xpixmap",xsl:"application/xml",xslt:"application/xslt+xml",yaml:"text/yaml",yml:"text/yaml",zip:"application/zip"}},{}]},{},[1])(1)});